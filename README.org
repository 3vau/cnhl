* cnhl
A Emacs trick to make Chinese highlight lexically.
(and a little for dividing Chinese words).

This program used THULAC (THU Lexical Analyzer for Chinese) by Tsinghua University.

#+BEGIN_QUOTE
Maosong Sun, Xinxiong Chen, Kaixu Zhang, Zhipeng Guo, Zhiyuan Liu. THULAC: An Efficient Lexical Analyzer for Chinese. 2016.
#+END_QUOTE

Thanks to people who helped me:
- [[http://ldbeth.sdf.org/][@LdBeth]]
- [[https://citreu.gitlab.io/][@cireu]]
- [[https://emacs-china.org/u/twlz0ne][@twlz0ne]]


** Screenshots
[[file:screenshots/4.png]]
[[file:screenshots/3.png]]
[[file:screenshots/1.png]]
[[file:screenshots/2.png]]

** 中文

cnhl——中文词性高亮工具

（还带有一点点分词功能）

本程序使用[[http://thulac.thunlp.org/][THULAC]]作为后端，感谢：

#+BEGIN_QUOTE
孙茂松, 陈新雄, 张开旭, 郭志芃, 刘知远. THULAC：一个高效的中文词法分析工具包. 2016.
#+END_QUOTE
感谢Emacs China论坛前辈们的热心帮助：
- [[http://ldbeth.sdf.org/][@LdBeth]]
- [[https://citreu.gitlab.io/][@cireu]]
- [[https://emacs-china.org/u/twlz0ne][@twlz0ne]]



#+BEGIN_QUOTE
欲寄彩笺兼尺素，山长水阔知何处？ —— （北宋）晏殊
#+END_QUOTE
愿这个小插件能为你的文思增添一抹别样的色彩。

*** 安装
**** 配置环境

cnhl需要安装了 =thulac= 包的 =python3= 作为词法分析后端，
要安装 =thulac= ，可以使用：
#+BEGIN_SRC bash
  pip install thulac
#+END_SRC

注意，THULAC的部分代码在 =Python 3.8= 及以上版本中已经过时，可以根据以下步骤修改。否则运行时可能会报 =AttributeError: module 'time' has no attribute 'clock'= 错误。
1. 前往python库文件的安装路径 （例如 =/usr/local/lib/python3.9= ）；
2. 在 =./thulac/characetr/CBTaggingDecoder.py= 的第170行左右，将：


#+BEGIN_SRC python
  start = time.start()
#+END_SRC
改为：
#+BEGIN_SRC python
  start = time.perf_counter()
#+END_SRC
之后THULAC便可以正常运行。

**** 安装cnhl.el

将 =cnhl.el= 加入emacs的 =load-path=，之后在配置文件中加入:
#+BEGIN_SRC elisp
  (require 'cnhl)
#+END_SRC
以加载cnhl。

*** 使用

若要在输入过程中实时高亮输入内容，请在配置文件中加入：
#+BEGIN_SRC elisp
  (add-hook 'after-change-functions #'cnhl-sentence-timely)
#+END_SRC


若要暂时禁用高亮（例如要编辑英文片段，或者只将cnhl用于分词），使用 =cnhl-hl-switch= 。注意，这不会清除已有的高亮。


函数列表：
| 函数名                  | 功能                                       | 默认按键 |
|-------------------------+--------------------------------------------+----------|
| cnhl                    | 对某一区域进行中文词性高亮（默认为当前行） |          |
| cnhl-sentence           | 对光标所在句进行中文词性高亮               |          |
| cnhl-buffer             | 对当前buffer全文逐行进行中文词性高亮       |          |
| cnhl-forward-word       | 向前移动一个词                             | M-f      |
| cnhl-backward-word      | 向后移动一个词                             | M-b      |
| cnhl-backward-kill-word | 向后删除一个词                             | M-DEL    |
| cnhl-kill-word          | 向前删除一个词                             | M-d      |

默认配色适用于暗色主题。亮色主题可以使用以下配置：
#+BEGIN_SRC elisp
  (set-face-foreground 'cnhl-n-r-j "#7D1F00")
  (set-face-foreground 'cnhl-a "#253E62")
  (set-face-foreground 'cnhl-f-s-t-m-q-mq "#613900")
  (set-face-foreground 'cnhl-u-y-h-k "#7A7108")
  (set-face-foreground 'cnhl-d-c-p "#6A2A62")
  (set-face-foreground 'cnhl-v-i-id "#2C4A1E")
  (set-face-foreground 'cnhl-g-w-x-e-o "gray15")
#+END_SRC

如果觉得上面的色彩太过鲜艳，可以使用对比度较低的：
#+BEGIN_SRC elisp
  (set-face-foreground 'cnhl-n-r-j "#4D1300")
  (set-face-foreground 'cnhl-a "#232346")
  (set-face-foreground 'cnhl-f-s-t-m-q-mq "#5E482A")
  (set-face-foreground 'cnhl-u-y-h-k "#62510E")
  (set-face-foreground 'cnhl-d-c-p "#4C4B1E")
  (set-face-foreground 'cnhl-v-i-id "#2D421C")
  (set-face-foreground 'cnhl-g-w-x-e-o "gray15")
#+END_SRC

这里提供的配色可能并不是很合你的胃口，如果想自己配置，可以使用Adobe Color作为辅助工具：[[https://color.adobe.com/]]

*** 已知问题
- [ ] 若当前行过长，则 =cnhl= 函数无法正常工作，进而影响到 =cnhl-buffer= ；


cnhl含有详细的中文注释，欢迎一切形式的意见、交流和帮助！

** English
*** Install
**** Environment
This program need =Python3= and above with =thulac= package installed.

To install =thulac=, use:
#+BEGIN_SRC bash
  pip install thulac
#+END_SRC

For =Python 3.8= and above, you need to repaire out-dated code in =thulac= by yourself,
or may received =AttributeError: module 'time' has no attribute 'clock'= :
1. Go to your Python's library path (for example, =/usr/local/lib/python3.9=);
2. Edit =./thulac/characetr/CBTaggingDecoder.py=, about the 170 line:
   #+BEGIN_SRC python
     start = time.start()
#+END_SRC
To:
#+BEGIN_SRC python
  start = time.perf_counter()
#+END_SRC
Then it would work normally.

**** cnhl.el
Put =cnhl.el= to your =load-path=, then add:
#+BEGIN_SRC elisp
  (require 'cnhl)
#+END_SRC
to your profile.

*** Usage
To highlight sentence when typing, add:
#+BEGIN_SRC elisp
  (add-hook 'after-change-functions #'cnhl-sentence-timely)
#+END_SRC
to your profile;


To disable highlight, use =cnhl-hl-switch= . It won't clear highlights which existed.


Functions:
| Name                    | Behavior                                                                   | Default-key |
|-------------------------+----------------------------------------------------------------------------+-------------|
| cnhl                    | Highlight Chinese from =beg= to =end=. Highlight current line for default. |             |
| cnhl-sentence           | Highlight current sentence. Judge sentence by chinese punctuation.         |             |
| cnhl-buffer             | Highlight whole buffer line by line.                                       |             |
| cnhl-forward-word       | Move forward for one word.                                                 | M-f         |
| cnhl-backward-word      | Move backward for one word.                                                | M-b         |
| cnhl-backward-kill-word | Delete one word backward.                                                  | M-DEL       |
| cnhl-kill-word          | Delete one word forward.                                                   | M-d         |

Default color is for dark theme. If you are in light theme, you can use:
#+BEGIN_SRC elisp
  (set-face-foreground 'cnhl-n-r-j "#7D1F00")
  (set-face-foreground 'cnhl-a "#253E62")
  (set-face-foreground 'cnhl-f-s-t-m-q-mq "#613900")
  (set-face-foreground 'cnhl-u-y-h-k "#7A7108")
  (set-face-foreground 'cnhl-d-c-p "#6A2A62")
  (set-face-foreground 'cnhl-v-i-id "#2C4A1E")
  (set-face-foreground 'cnhl-g-w-x-e-o "gray15")
#+END_SRC

For low contrast:
#+BEGIN_SRC elisp
  (set-face-foreground 'cnhl-n-r-j "#4D1300")
  (set-face-foreground 'cnhl-a "#232346")
  (set-face-foreground 'cnhl-f-s-t-m-q-mq "#5E482A")
  (set-face-foreground 'cnhl-u-y-h-k "#62510E")
  (set-face-foreground 'cnhl-d-c-p "#4C4B1E")
  (set-face-foreground 'cnhl-v-i-id "#2D421C")
  (set-face-foreground 'cnhl-g-w-x-e-o "gray15")
#+END_SRC

It's may not very suit for you, and you can design it by yourself.
Useful tool: [[https://color.adobe.com/]]
